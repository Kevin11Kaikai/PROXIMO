# Conversation Layer æµ‹è¯•æŒ‡å—

æœ¬æ–‡ä»¶å¤¹åŒ…å« Conversation Layerï¼ˆå¯¹è¯æ‰§è¡Œå±‚ï¼‰çš„æµ‹è¯•è„šæœ¬ã€‚

## ğŸ“‹ æµ‹è¯•è„šæœ¬åˆ—è¡¨

1. **`test_low_risk_agent.py`** - Low Risk Agent æµ‹è¯•
   - æµ‹è¯•åŸºæœ¬å“åº”ç”Ÿæˆ
   - æµ‹è¯•å¸¦å†å²è®°å½•çš„å¯¹è¯
   - æµ‹è¯• Goodbye æ£€æµ‹
   - æµ‹è¯•åŸºäº Rigidity çš„æ¸©åº¦è°ƒæ•´

2. **`test_medium_risk_agent.py`** - Medium Risk Agent æµ‹è¯•
   - æµ‹è¯•åˆå§‹å»ºè®®
   - æµ‹è¯•æŠ—æ‹’æ£€æµ‹ï¼ˆprivacy, time, stigma, doubtï¼‰
   - æµ‹è¯•æŠ—æ‹’å¤„ç†ï¼ˆå¤šè½®å¯¹è¯ï¼‰
   - æµ‹è¯•ç”¨æˆ·æ¥å—
   - æµ‹è¯•æœ€å¤§è¯´æœè½®æ¬¡é™åˆ¶ï¼ˆ5è½®ï¼‰
   - æµ‹è¯•çŠ¶æ€é‡ç½®

3. **`test_high_risk_agent.py`** - High Risk Agent æµ‹è¯•
   - æµ‹è¯•å›ºå®šå®‰å…¨è„šæœ¬
   - æµ‹è¯•è„šæœ¬å†…å®¹è¦æ±‚ï¼ˆ988, crisis, safety, emergency, helpï¼‰
   - æµ‹è¯•å“åº”å…ƒæ•°æ®
   - æµ‹è¯• get_script æ–¹æ³•

4. **`test_pipeline.py`** - é›†æˆæµ‹è¯•
   - æµ‹è¯• Low Risk ç®¡é“
   - æµ‹è¯• Medium Risk ç®¡é“
   - æµ‹è¯• High Risk ç®¡é“
   - æµ‹è¯•å¯¹è¯å†å²ç®¡ç†
   - æµ‹è¯•æ¸…é™¤å¯¹è¯

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œå•ä¸ªæµ‹è¯•

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate PROXIMO

# è¿è¡Œ Low Risk Agent æµ‹è¯•ï¼ˆéœ€è¦ Ollamaï¼‰
python test_conversation_layer/test_low_risk_agent.py

# è¿è¡Œ Medium Risk Agent æµ‹è¯•ï¼ˆéœ€è¦ Ollamaï¼‰
python test_conversation_layer/test_medium_risk_agent.py

# è¿è¡Œ High Risk Agent æµ‹è¯•ï¼ˆä¸éœ€è¦ Ollamaï¼Œä½¿ç”¨å›ºå®šè„šæœ¬ï¼‰
python test_conversation_layer/test_high_risk_agent.py

# è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦ Ollamaï¼‰
python test_conversation_layer/test_pipeline.py
```

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# ä½¿ç”¨ pytestï¼ˆå¦‚æœå¯ç”¨ï¼‰
conda run -n PROXIMO pytest test_conversation_layer/ -v

# æˆ–é€ä¸ªè¿è¡Œ
for test in test_conversation_layer/test_*.py; do
    conda run -n PROXIMO python "$test"
done
```

## ğŸ“ å‰ç½®æ¡ä»¶

### æ‰€æœ‰æµ‹è¯•éƒ½éœ€è¦
- PROXIMO conda ç¯å¢ƒ
- Python 3.10+
- é¡¹ç›®ä¾èµ–å·²å®‰è£…

### Low/Medium Risk Agent æµ‹è¯•éœ€è¦
- Ollama æœåŠ¡è¿è¡Œ
- æ¨¡å‹å·²åŠ è½½ï¼ˆqwen2.5:14b æˆ–ç±»ä¼¼ï¼‰

### High Risk Agent æµ‹è¯•
- **ä¸éœ€è¦** Ollamaï¼ˆä½¿ç”¨å›ºå®šè„šæœ¬ï¼‰

## ğŸ§ª æµ‹è¯•åœºæ™¯

### Low Risk Agent
- **è¡Œä¸º**ï¼šè‡ªç”±å¯¹è¯ + åº”å¯¹æŠ€èƒ½å»ºè®®
- **è‡ªç”±åº¦**ï¼šæœ€é«˜ï¼ˆtemperature = 0.9ï¼‰
- **ç»“æŸæ¡ä»¶**ï¼šç”¨æˆ·è¯´å†è§

### Medium Risk Agent
- **è¡Œä¸º**ï¼šåŠç»“æ„åŒ– + Peer Support Group å¼•å¯¼
- **çŠ¶æ€æœº**ï¼š
  1. åˆå§‹å»ºè®®
  2. æ£€æµ‹æŠ—æ‹’ï¼ˆprivacy, time, stigma, doubtï¼‰
  3. å¤„ç†æŠ—æ‹’ï¼ˆæœ€å¤š 5 è½®ï¼‰
  4. æ¥å—/æ‹’ç»
  5. æä¾›èµ„æºï¼ˆå¦‚æœæ‹’ç»ï¼‰

### High Risk Agent
- **è¡Œä¸º**ï¼šå›ºå®šè„šæœ¬ + Crisis Hotlineï¼ˆ988ï¼‰
- **è‡ªç”±åº¦**ï¼šæœ€ä½ï¼ˆå›ºå®šè„šæœ¬ï¼Œä¸å…è®¸è‡ªç”±å¯¹è¯ï¼‰
- **è„šæœ¬å†…å®¹**ï¼šå¿…é¡»åŒ…å« 988ã€crisisã€safetyã€emergencyã€help

## ğŸ“Š é¢„æœŸç»“æœ

### Low Risk Agent æµ‹è¯•
- âœ… ç”Ÿæˆè‡ªç„¶ã€å…±æƒ…çš„å“åº”
- âœ… å»ºè®®åº”å¯¹æŠ€èƒ½
- âœ… æ­£ç¡®æ£€æµ‹ Goodbye
- âœ… æ¸©åº¦éš Rigidity è°ƒæ•´

### Medium Risk Agent æµ‹è¯•
- âœ… çŠ¶æ€æœºæ­£ç¡®è½¬æ¢
- âœ… æ£€æµ‹æŠ—æ‹’ç±»å‹
- âœ… å¤„ç†æŠ—æ‹’ï¼ˆæœ€å¤š 5 è½®ï¼‰
- âœ… ç”¨æˆ·æ¥å—æ—¶ç¡®è®¤
- âœ… è¶…è¿‡ 5 è½®åæä¾›èµ„æº

### High Risk Agent æµ‹è¯•
- âœ… å§‹ç»ˆè¿”å›å›ºå®šè„šæœ¬
- âœ… åŒ…å«æ‰€æœ‰å¿…éœ€å…ƒç´ 
- âœ… å…ƒæ•°æ®æ­£ç¡®

### é›†æˆæµ‹è¯•
- âœ… æ­£ç¡®è·¯ç”±åˆ°å¯¹åº” Agent
- âœ… å¯¹è¯å†å²æ­£ç¡®ç®¡ç†
- âœ… æ¸…é™¤å¯¹è¯åŠŸèƒ½æ­£å¸¸

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Medium Risk Agent çŠ¶æ€æœº**ï¼š
   - æ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹çŠ¶æ€
   - çŠ¶æ€åœ¨å¯¹è¯è¿‡ç¨‹ä¸­ä¿æŒ
   - éœ€è¦è°ƒç”¨ `reset_state()` é‡ç½®

2. **High Risk Agent**ï¼š
   - å¿…é¡»ä½¿ç”¨å›ºå®šè„šæœ¬
   - ä¸å…è®¸è‡ªç”±å¯¹è¯
   - è„šæœ¬å†…å®¹åœ¨è®¾è®¡é˜¶æ®µå·²éªŒè¯

3. **å¯¹è¯å†å²**ï¼š
   - è‡ªåŠ¨ä¿å­˜åˆ° SessionService
   - æœ€å¤šä¿ç•™ 6 è½®å¯¹è¯
   - å¯ä»¥æ‰‹åŠ¨æ¸…é™¤

## ğŸ” è°ƒè¯•

å¦‚æœæµ‹è¯•å¤±è´¥ï¼š

1. **Ollama è¿æ¥é—®é¢˜**ï¼š
   - æ£€æŸ¥ Ollama æœåŠ¡æ˜¯å¦è¿è¡Œ
   - æ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²åŠ è½½
   - æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

2. **çŠ¶æ€æœºé—®é¢˜**ï¼š
   - æ£€æŸ¥ Medium Risk Agent çŠ¶æ€è½¬æ¢
   - ç¡®è®¤æŠ—æ‹’æ£€æµ‹å…³é”®è¯
   - éªŒè¯æœ€å¤§è½®æ¬¡é™åˆ¶

3. **å›ºå®šè„šæœ¬é—®é¢˜**ï¼š
   - ç¡®è®¤ High Risk Agent ä½¿ç”¨å›ºå®šè„šæœ¬
   - æ£€æŸ¥è„šæœ¬å†…å®¹æ˜¯å¦å®Œæ•´

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-07  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

